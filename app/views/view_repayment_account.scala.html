@*
 * Copyright 2023 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import model.des.*
@import model.*
@import uk.gov.hmrc.govukfrontend.views.html.components.*
@import config.ViewConfig
@import play.twirl.api.HtmlFormat

@this(
 mainTemplate: views.html.main_template,
 govukSummaryList: GovukSummaryList,
 govukWarningText: GovukWarningText,
 govukButton: GovukButton,
 viewConfig: ViewConfig
)

@(
  bankDetailsOption: Option[BankDetails],
  inFlight: Boolean,
  returnPage : ReturnPage,
  date: Option[String],
  welshDate: Option[String]
)(using request: Request[?], messages: Messages)

@title = @{
  if (inFlight) Messages("view_repayment_account.title.inFlight")
  else Messages("view_repayment_account.title")
}

@mainTemplate(title = title, hasBackLink = true) {
 <div class="govuk-grid-row govuk-!-padding-bottom-2">
    <div class="govuk-grid-column-two-thirds">
        <h1 id="main-message" class="govuk-heading-xl">@title</h1>
        @if(inFlight) {
            @govukWarningText(WarningText(content = Text(Messages(
              "view_repayment_account.warning",
              if(messages.lang.code == "en") {date.getOrElse("")} else if(messages.lang.code == "cy") {welshDate.getOrElse("")} else ""
            ))))
        }

    @bankDetailsOption.map { bankDetails =>

       @govukSummaryList(SummaryList(
           card = Some(Card(
               title = Some(CardTitle(Text(Messages("view_repayment_account.repayment_account_details")),
                   classes = "govuk-card__header__text"))
           )),
           rows = Seq(
               SummaryListRow(
                   classes = "govuk-summary-list__row",
                   key = Key(
                       content = HtmlContent(Html(Messages("view_repayment_account.name_on_account"))),
                       classes = "govuk-summary-list__key"
                   ),
                   value = Value(
                       content = HtmlContent(Html(s"""<span id="acc-name">${HtmlFormat.escape(bankDetails.accountHolderName.fold("")(identity))}</span>"""))
                   )
               ),
               SummaryListRow(
                   classes = "govuk-summary-list__row",
                   key = Key(
                       content = HtmlContent(Html(Messages("view_repayment_account.sort_code"))),
                       classes = "govuk-summary-list__key"
                   ),
                   value = Value(
                       content = HtmlContent(Html(s"""<span id="acc-sort-code">${HtmlFormat.escape(bankDetails.formatSortCode)}</span>"""))
                   )
               ),
               SummaryListRow(
                   classes = "govuk-summary-list__row",
                   key = Key(
                       content = HtmlContent(Html(Messages("view_repayment_account.account_number"))),
                       classes = "govuk-summary-list__key"
                   ),
                   value = Value(
                       content = HtmlContent(Html(s"""<span id="acc-number">${HtmlFormat.escape(bankDetails.obscureBankAccountNumber)}</span>"""))
                   )
               ),
               SummaryListRow(
                   classes = "govuk-summary-list__row",
                   key = Key(
                       content = HtmlContent(Html(Messages("view_repayment_account.building_society_number"))),
                       classes = "govuk-summary-list__key"
                   ),
                   value = Value(
                       content = HtmlContent(Html(s"""<span id="building-society-number">${HtmlFormat.escape(bankDetails.buildingSocietyNumber.fold("")(identity))}</span>"""))
                   )
               )
           )
        )
       )
    }
    <a class="govuk-link govuk-!-font-size-19" href='@routes.BankAccountCocController.startBankAccountCocJourney(returnPage)' id="call-bac">@{
       if (!inFlight) Messages("view_repayment_account.change_account_details")
       else Messages("")
    }</a>

    @if(inFlight) {
       @govukButton(Button(
           content = Text(Messages("view_repayment_account.return_to_vat")),
           href = Some(viewConfig.viewVatAccount),
           id = Some("return-to-vat")
       ))
    }

    </div>
 </div>

}
